# Astra-250612 vs astra-4 fork: Modules and Options Diff

## Method
- Binary modules: extracted from `astra/re/ghidra/output/xref_map.tsv` file path strings.
- Binary options: extracted from `option '...'` error strings (required options only).
- Fork modules/options: extracted from C modules in `astra/modules` (module_option_* and MODULE_OPTIONS_IDX lookups).

## Modules only in astra-250612

- `dvb_ci` (required options: n/a)
- `dvb_it950x` (required options: n/a)
- `epg_export` (required options: callback, name)
- `exec` (required options: cmd)
- `gorynich` (required options: n/a)
- `http_hls` (required options: n/a)
- `http_input` (required options: name)
- `http_playlist_icon` (required options: n/a)
- `http_stream` (required options: n/a)
- `media_aspect` (required options: n/a)
- `mpts` (required options: country, name, pat_interval, upstream)
- `mux` (required options: mux, name, pid)
- `resi` (required options: n/a)
- `rtsp_input` (required options: name)
- `sessions_auth` (required options: n/a)
- `srt_input` (required options: name)
- `srt_output` (required options: name)
- `stream` (required options: n/a)
- `t2mi` (required options: n/a)
- `tbsmod` (required options: n/a)

## Modules only in astra-4 fork

- `astra` (options: n/a)
- `base64` (options: n/a)
- `biss_encrypt` (options: key)
- `ddci` (options: device)
- `dvbls` (options: n/a)
- `hls_output` (options: base_url, cleanup, naming, pass_data, path, playlist, prefix, round_duration, target_duration, ts_extension, use_wall, window)
- `http_buffer` (options: n/a)
- `http_redirect` (options: code, location)
- `http_upstream` (options: buffer_fill, buffer_size, callback)
- `inscript` (options: n/a)
- `iso8859` (options: n/a)
- `json` (options: n/a)
- `log` (options: n/a)
- `md5` (options: n/a)
- `mixaudio` (options: direction, pid)
- `pidfile` (options: n/a)
- `postgres` (options: connect_string)
- `process` (options: n/a)
- `rc4` (options: n/a)
- `sha1` (options: n/a)
- `sqlite` (options: n/a)
- `str2hex` (options: n/a)
- `utils` (options: n/a)

## Shared modules: options diff

- `analyze`
  - fork options: bitrate_limit, callback, cc_limit, join_pid, name, rate_stat
  - binary required: name
- `asi_input`
  - fork options: adapter, budget
  - binary required: adapter
- `channel`
  - fork options: cas, filter, filter~, map, name, no_eit, no_reload, no_sdt, pass_eit, pass_sdt, pid, pnr, service_name, service_provider, set_pnr, set_tsid
  - binary required: custom_pmt, define_pid, lang, map, name, order
- `decrypt`
  - fork options: biss, cas_data, cas_pnr, disable_emm, ecm_pid, name, shift
  - binary required: name
- `dvb_input`
  - fork options: budget, buffer_size, ca_pmt_delay, callback, device, diseqc, lnb_sharing, lof1, lof2, log_signal, no_dvr, raw_signal, slof, stream_id, timeout, tone, uni_frequency, uni_scr
  - binary required: diseqc
- `file_input`
  - fork options: buffer_size, check_length, filename, lock, loop
  - binary required: name
- `file_output`
  - fork options: aio, buffer_size, directio, filename, m2ts
  - binary required: filename
- `http_downstream`
  - fork options: callback
  - binary required: callback
- `http_request`
  - fork options: buffer_fill, buffer_size, host, port, sctp, sync, timeout, upstream
  - binary required: callback, host
- `http_server`
  - fork options: addr, http_version, port, route, sctp, server_name
  - binary required: n/a
- `http_static`
  - fork options: block_size, default_mime, expires, headers, m3u_headers, path, skip, ts_extension, ts_headers
  - binary required: path
- `http_websocket`
  - fork options: callback
  - binary required: callback
- `newcamd`
  - fork options: disable_emm, host, key, name, pass, port, timeout, user
  - binary required: host, name, pass, port, user
- `timer`
  - fork options: callback, interval
  - binary required: callback, interval
- `transmit`
  - fork options: n/a
  - binary required: n/a
- `udp_input`
  - fork options: addr, localaddr, port, renew, rtp, socket_size
  - binary required: name
- `udp_output`
  - fork options: addr, cbr, localaddr, port, rtp, socket_size, sync, ttl
  - binary required: name

## Config/runtime + UI/JSON schema mapping

### Sources + raw mapping
- UI forms: `astra/web/app.js` (`collect*Settings`, `read*Form`, `save*` payloads).
- Lua config/runtime: `astra/scripts/*.lua` (`get_setting` / `setting_*` usage).
- JSON export schema: `astra/scripts/config.lua` (`config.export_astra`).
- Raw map: `astra/re/astra-250612-diff-config-ui.json` (generated by `astra/re/tools/extract_config_ui_map.py`).

### Settings keys (UI vs Lua config/runtime)
- UI settings (47 keys, grouped by form):
  - HLS: `hls_duration` `hls_m3u_headers` `hls_naming` `hls_pass_data` `hls_quantity` `hls_resource_path` `hls_round_duration` `hls_session_timeout` `hls_ts_extension` `hls_ts_headers` `hls_ts_mime` `hls_use_expires`
  - HTTP Play: `http_play_allow` `http_play_arrange` `http_play_buffer_kb` `http_play_hls` `http_play_logos` `http_play_m3u_header` `http_play_no_tls` `http_play_playlist_name` `http_play_port` `http_play_screens` `http_play_xspf_title`
  - Buffer server: `buffer_client_read_timeout_sec` `buffer_enabled` `buffer_listen_host` `buffer_listen_port` `buffer_max_clients_total` `buffer_source_bind_interface`
  - HTTP Auth + Token: `auth_admin_bypass_enabled` `auth_allow_no_token` `auth_default_duration_sec` `auth_deny_cache_sec` `auth_hash_algo` `auth_hls_rewrite_token` `auth_on_play_url` `auth_on_publish_url` `auth_overlimit_policy` `auth_timeout_ms` `http_auth_allow` `http_auth_deny` `http_auth_enabled` `http_auth_realm` `http_auth_tokens` `http_auth_users`
- UI-only settings: none (UI is a strict subset of Lua settings).
- Lua-only settings (21 keys): `access_log_max_entries` `access_log_retention_sec` `auth_session_ttl_sec` `backup_active_warm_max` `event_request` `gid` `hls_base_url` `hls_dir` `http_csrf_enabled` `http_play_stream` `log_max_entries` `log_retention_sec` `password_disallow_username` `password_min_length` `password_require_letter` `password_require_mixed_case` `password_require_number` `password_require_symbol` `rate_limit_login_per_min` `rate_limit_login_window_sec` `softcam`
- Notes:
  - `gid` and `softcam` are exported as top-level JSON keys (not under `settings`).
  - `http_play_stream` is a legacy import alias mapped to `http_play_allow`.
  - `event_request` is used by transcode alert callbacks.

### Stream config mapping (UI -> JSON `make_stream[]`)
- UI stream config keys (saved in `make_stream[]`): `auth_enabled` `backup_active_warm_max` `backup_initial_delay` `backup_return_delay` `backup_start_delay` `backup_type` `description` `http_keep_active` `id` `input` `map` `mpts` `name` `no_data_timeout_sec` `on_play` `on_publish` `output` `probe_interval_sec` `service_name` `service_provider` `session_keys` `set_pnr` `set_tsid` `stable_ok_sec` `timeout` `transcode` `type`
- Input URL parts (UI -> `make_stream[].input[]` URL composition): `addr` `dvbId` `file` `host` `iface` `login` `password` `path` `port` `url`
- Input URL options (query params inside the URL): `biss` `bitrate_limit` `bridge_port` `buffer_size` `cam` `cas` `cc_limit` `ecm_pid` `filter` `filter~` `loop` `map` `no_analyze` `no_reload` `pass_eit` `pass_sdt` `pnr` `set_pnr` `set_tsid` `shift` `socket_size` `timeout` `ua`
- Output fields (UI -> `make_stream[].output[]`):
  - HTTP: `buffer_fill` `buffer_size` `host` `keep_active` `path` `port`
  - HLS: `base_url` `cleanup` `path` `playlist` `prefix` `target_duration` `use_wall` `window`
  - UDP/RTP: `addr` `cbr` `localaddr` `port` `socket_size` `sync` `ttl`
  - SRT: `bridge_port` `url`
  - NetworkPush: `buffer_size` `host` `path` `port` `timeout`
  - File: `aio` `buffer_size` `directio` `filename` `m2ts`
- Notes:
  - `auto` is UI-only (HLS output helper) and is stripped before save.
  - Runtime `scripts/stream.lua` consumes `conf.*` for input/output configs; overlap is strongest on output fields and URL parts, not on top-level stream keys.

### Transcode config mapping (UI -> JSON `make_stream[].transcode`)
- Transcode config keys: `common_output_args` `decoder_args` `engine` `ffmpeg_global_args` `ffmpeg_path` `gpu_device` `log_file` `outputs` `watchdog`
- Transcode output keys: `a_args` `acodec` `format_args` `metadata` `name` `url` `v_args` `vcodec` `vf`
- Watchdog keys: `desync_fail_count` `desync_threshold_ms` `max_error_lines_per_min` `max_restarts_per_10min` `no_progress_timeout_sec` `probe_duration_sec` `probe_fail_count` `probe_interval_sec` `probe_timeout_sec` `probe_url` `restart_delay_sec`
- Runtime deltas:
  - Lua-only: `ffmpeg_bin`, `common_input_args`
  - UI-only: `gpu_device`
  - Output `name` is UI-only (runtime ignores it).

### Adapter config mapping (UI -> JSON `dvb_tune[]`)
- UI adapter config keys: `adapter` `bandwidth` `budget` `buffer_size` `ca_pmt_delay` `device` `diseqc` `frequency` `guardinterval` `hierarchy` `id` `lnb` `lnb_sharing` `log_signal` `modulation` `raw_signal` `rolloff` `stream_id` `symbolrate` `tone` `tp` `transmitmode` `type` `uni_frequency` `uni_scr`

### Splitter config mapping (UI -> JSON `splitters[]`)
- Splitter keys: `config_path` `enable` `id` `in_interface` `logpath` `logtype` `name` `out_interface` `port`
- Link keys: `bandwidth` `buffering` `enable` `id` `url`
- Allow keys: `kind` `value`
- Export schema includes `splitters[].{id, enable, port, name, in_interface, out_interface, logtype, logpath, config_path, links[], allow[]}`.

### Buffer config (UI + API only)
- Buffer resources: `av_pts_align_enabled` `av_pts_max_desync_ms` `backup_probe_interval_sec` `backup_return_delay_sec` `backup_start_delay_sec` `backup_type` `bandwidth_kbps` `buffering_sec` `client_start_offset_sec` `enable` `keyframe_detect_mode` `max_client_lag_ms` `name` `no_data_timeout_sec` `pacing_mode` `paramset_required` `path` `smart_lookback_ms` `smart_max_lead_ms` `smart_require_keyframe` `smart_require_pat_pmt` `smart_require_pcr` `smart_start_enabled` `smart_target_delay_ms` `smart_wait_ready_ms` `start_debug_enabled` `ts_drop_corrupt_enabled` `ts_resync_enabled` `ts_rewrite_cc_enabled`
- Buffer inputs: `enable` `priority` `url`
- Buffer allow rules: `kind` `value`
- Notes: buffers are not part of `config.export_astra` JSON payload; they are managed via `/api/v1/buffers/*` endpoints only.
