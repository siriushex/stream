# PNG to Stream (резервный TS из PNG)

PNG to Stream делает короткий MPEG-TS файл из картинки и звука.
Это удобный "последний резерв": заставка + звук, когда основной источник упал.

!!! note "Требует ffmpeg"
    Функция использует `ffmpeg`/`ffprobe`.
    В сборке **LITE (no transcode)** этот раздел недоступен.

## Где находится

**Edit stream -> Transcode -> PNG to Stream**

## Как это работает

- Вы загружаете PNG и выбираете звук (Silence / Beep / MP3).
- Stream запускает `ffmpeg` и пишет `.ts` в `data/streams/<stream_id>/backup/`.
- После генерации Web UI:
  - добавляет `file://...#loop` в **INPUT LIST**,
  - если `Backup mode` пустой или `disabled` - выставляет `active`,
  - показывает файл в списке "Созданные TS файлы" (можно переиспользовать).
- Дальше нажмите **Save** внизу окна, чтобы сохранить изменения стрима.

## Шаги

1. Откройте канал -> **Edit stream**.
2. Перейдите во вкладку **Transcode**.
3. В блоке **PNG to Stream** выберите PNG.
4. Выберите звук:
   - **Silence**: тишина.
   - **Beep**: генератор тона (пресеты).
   - **MP3**: ваш файл.
5. Нажмите **Analyze main stream** (рекомендуется).
6. Нажмите **Generate TS**.
7. Проверьте, что в **INPUT LIST** появился `file://...#loop`.
8. Нажмите **Save**.

## Что делает "Analyze main stream"

Stream пытается снять параметры видео через `ffprobe` (первый video stream):

- codec,
- width/height,
- FPS,
- pixel format,
- profile/level (если есть).

Если анализ прошел, эти значения подставятся в "Output settings".
Так резервный TS будет ближе к основному потоку.

## Созданные TS файлы

Внизу блока есть список "Созданные TS файлы".

- Кнопка **Подставить** добавляет файл в **INPUT LIST** как `file://...#loop`.
- Удобно, когда вы хотите быстро вернуть резерв без повторной генерации.

## Где лежат файлы

По умолчанию:

```text
data/streams/<stream_id>/backup/backup-from-png_*.ts
```

## Типовые ошибки

- **ffmpeg/ffprobe не найден**: установите `ffmpeg` в системе.
- **PNG/MP3 не читается**: проверьте файл и права доступа.
- **TS не добавился в INPUT LIST**: обновите страницу и посмотрите блок "Созданные TS файлы".
